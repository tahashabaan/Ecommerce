{"ast":null,"code":"import _regeneratorRuntime from\"X:/kalBanan/udemy/projects/e_commerce/Ecommerce/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"X:/kalBanan/udemy/projects/e_commerce/Ecommerce/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"X:/kalBanan/udemy/projects/e_commerce/Ecommerce/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useContext}from'react';import{CardElement,PaymentElement,useElements,useStripe}from'@stripe/react-stripe-js';import axios from'../../axios';import{useNavigate}from'react-router-dom';import classes from'./CheckOut.module.css';import CartContext from'../../store/cart-context';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CheckOut=function CheckOut(props){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),cardElement=_useState2[0],setCardElement=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),secertKey=_useState4[0],setSecertKey=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),sucessed=_useState6[0],setSucessed=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disable=_useState8[0],setDisable=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),error=_useState10[0],setError=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loading=_useState12[0],setLoading=_useState12[1];var stripe=useStripe();var elements=useElements();var navigate=useNavigate();var _useContext=useContext(CartContext),totalAmount=_useContext.totalAmount;useEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.post({method:'post',url:\"/payment/create? amount=\".concat(totalAmount*100)});case 2:response=_context.sent;setSecertKey(response.data.clientSecret);return _context.abrupt(\"return\",response);case 5:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[totalAmount]);var submitHandle=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e){var payload;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);e.preventDefault();_context2.next=4;return stripe.confirmCardPayment(secertKey,{payment_method:{card:elements.getElement(CardElement)}}).then(function(paymentIntent){setSucessed(true);setLoading(false);setError(null);navigate('/cart',{replace:true});});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function submitHandle(_x){return _ref2.apply(this,arguments);};}();var changeHandle=function changeHandle(e){setDisable(false);setError(error?error.message:'');// setCardElement(e.target.value);\n// console.log(cardElement);\n};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandle,className:classes.form,children:[/*#__PURE__*/_jsx(CardElement,{onChange:changeHandle,className:classes.cardElement}),/*#__PURE__*/_jsx(\"button\",{disabled:disable||loading||sucessed,children:loading?\"laoding...\":\"BuyNow\"}),error&&/*#__PURE__*/_jsx(\"p\",{children:error})]});};export default CheckOut;","map":{"version":3,"names":["React","useState","useEffect","useContext","CardElement","PaymentElement","useElements","useStripe","axios","useNavigate","classes","CartContext","CheckOut","props","cardElement","setCardElement","secertKey","setSecertKey","sucessed","setSucessed","disable","setDisable","error","setError","loading","setLoading","stripe","elements","navigate","totalAmount","getClientSecret","post","method","url","response","data","clientSecret","submitHandle","e","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","replace","payload","changeHandle","message","form"],"sources":["X:/kalBanan/udemy/projects/e_commerce/Ecommerce/src/component/CartProduct/CheckOut.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from 'react'\r\nimport { CardElement, PaymentElement, useElements, useStripe} from '@stripe/react-stripe-js';\r\nimport axios from '../../axios';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport classes from './CheckOut.module.css'\r\nimport CartContext from '../../store/cart-context';\r\n\r\n\r\nconst CheckOut = (props) => { \r\n\r\n  const [cardElement, setCardElement] = useState(null);\r\n  const [secertKey, setSecertKey] = useState(null);\r\n\r\n  const [sucessed, setSucessed ] = useState(false);\r\n  const [disable, setDisable] = useState(true);\r\n  const [error, setError ] = useState(null);\r\n  const [loading, setLoading ] = useState(false);\r\n  \r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const navigate =  useNavigate();\r\n  \r\n  const {totalAmount} = useContext(CartContext)\r\n  \r\n\r\n\r\n  useEffect(() => {\r\n    const getClientSecret = async () => {\r\n\r\n     const response = await axios.post({\r\n        method:'post',\r\n        url:`/payment/create? amount=${totalAmount * 100}`,\r\n      })\r\n\r\n      setSecertKey(response.data.clientSecret);\r\n      return response;\r\n    }\r\n    getClientSecret();\r\n  \r\n  }, [totalAmount])\r\n  \r\n  const submitHandle = async (e) => {\r\n\r\n    setLoading(true);\r\n    e.preventDefault();  \r\n\r\n    const payload = await stripe.confirmCardPayment(secertKey,{\r\n         payment_method:{\r\n          card:elements.getElement(CardElement)\r\n         }\r\n    }).then((paymentIntent ) => {\r\n       setSucessed(true);\r\n       setLoading(false);\r\n       setError(null);\r\n       navigate('/cart', {replace:true})\r\n\r\n    })\r\n  }\r\n\r\n  const changeHandle = (e) => {\r\n    setDisable(false);\r\n    setError(error? error.message :'');\r\n\r\n    // setCardElement(e.target.value);\r\n    // console.log(cardElement);\r\n  }\r\n\r\n  \r\n\r\n  \r\n  return (\r\n  \r\n      <form onSubmit={submitHandle} className={classes.form}>\r\n       \r\n        {/* <PaymentElement/> */}\r\n        {/* <PaymentElement/> */}\r\n        <CardElement onChange={changeHandle} className={classes.cardElement}/>\r\n      \r\n        <button disabled={disable || loading || sucessed}>\r\n           {loading? \"laoding...\":\"BuyNow\"}\r\n        </button>\r\n\r\n        {error && <p>{error}</p>}\r\n       </form>\r\n   \r\n  )\r\n}\r\n\r\nexport default CheckOut"],"mappings":"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"},"metadata":{},"sourceType":"module"}